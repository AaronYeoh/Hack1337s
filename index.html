<!DOCTYPE html>
<html>
  <head>
  <script src="jquery-2.1.4.min.js"></script>
    <style type="text/css">
      html, body, #map-canvas { height: 100%; margin: 0; padding: 0;}
	  .input { height: 50px; width: 100%; background-color: blue;
	  position: absolute; top: 101px}
    </style>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCxq4HFwFolVwN5GcDRMmgSInQkHpYfxmA">
    </script>
    
  </head>
  <body>
	<div id="map-canvas"></div>
	<div class="input">
	<form id="bus-form">
		<input type="number" id="stopNumField"/>
		<button id="bus-submit-btn" type="submit" name="submit">Submit</button>
	</form>
	</div>
	<script type="text/javascript">

		$(document).ready(function () {
			var busStopBtn;

				console.log('doc ready');

		      function initialize() {
		        var mapOptions = {
		          center: { lat: -36.8406, lng: 174.74},
		          zoom: 13,
				  disableDefaultUI: true,
				  streetViewControl: false
		        };
		        var map = new google.maps.Map(document.getElementById('map-canvas'),
		            mapOptions);
		      }
			  google.maps.event.addDomListener(window, 'load', initialize);


			  $('#bus-form').on('submit', function (event) {
				var busStopNum = $("#stopNumField").val();
				var requestURL = "http://at1337testapi.azurewebsites.net/stop_code=" + busStopNum;
				
				console.log('submit', event);

				event.preventDefault();

				console.log('bus stop num', busStopNum, requestURL);
			
				$.ajax({
					url: requestURL,
					success: function (data) {
						console.log('updating map', data);
						updateMap(data)
					},
					error: function () {
						console.log('error');
					}
				});
				
				console.log('end');
			  });
	  

		});
    	
	  function updateMap(routes) {
				
		console.log('trying to update map');
		for(var i = 0; i < routes[0].coordinates.length; i++) {
			routes.push(new google.maps.LatLng(routes[0].coordinates[i].latitude, routes[0].coordinates[i].longitude));
		}
		
		console.log('routes', routes);
		
		routePolygon = new google.maps.Polygon({
			paths: routes,
			strokeColor: '#FF0000',
			strokeOpacity: 0.8,
			strokeWeight: 2,
			fillColor: '#FF0000',
			fillOpacity: 0
		});
		
		routePolygon.setMap(map);
		google.maps.event.trigger(map, 'resize');
		}

    </script>
  </body>
</html>